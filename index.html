<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>迷子の迷子の子ぜくちゃん</title>
  
  <!-- 파비콘 추가 -->
  <link rel="icon" href="favicon.ico.png" type="image/png">

  <!-- Zen Kurenaido 구글 폰트 추가 -->
  <link href="https://fonts.googleapis.com/css2?family=Zen+Kurenaido&display=swap" rel="stylesheet">

  <!-- Firebase 연결 -->
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCfG9Y1mARnqsJ6O1J3_jSkWmX5ub1G5a0",
      authDomain: "maigosanhe.firebaseapp.com",
      databaseURL: "https://maigosanhe-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "maigosanhe",
      storageBucket: "maigosanhe.firebasestorage.app",
      messagingSenderId: "181163114151",
      appId: "1:181163114151:web:89ec1c2e6f6513dc6d6582",
      measurementId: "G-EDHDZ6X3DQ"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
  </script>

  <style>
    body {
      font-family: 'Zen Kurenaido', sans-serif;
      margin: 20px;
      background-color: #1c1c1c;
      color: #f0f0f0;
      text-align: center;
    }
    input, button {
      margin: 5px 0;
      padding: 10px;
      width: 100%;
      background-color: #2c2c2c;
      border: 1px solid #555;
      color: #f0f0f0;
      font-family: 'Zen Kurenaido', sans-serif;
      border-radius: 8px;
    }
    input::placeholder {
      color: #aaa;
    }
    button {
      background-color: #6a0dad;
      border: none;
      font-weight: bold;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #8536d3;
    }
    #registerArea, #searchArea {
      max-width: 400px;
      margin: 0 auto 20px;
      text-align: left;
    }
    #songList {
      margin-top: 20px;
    }
    .songItem {
      margin-bottom: 10px;
      background-color: #2a2a2a;
      padding: 10px;
      border-radius: 8px;
      font-size: 16px;
    }
    #message {
      margin-top: 10px;
      color: #a970ff;
      font-size: 14px;
      visibility: hidden;
    }
    hr {
      margin: 0.5px 0; /* 너가 요청한 걸로 반영 */
      border: 0;
      height: 1px;
      background: #aaa;
      opacity: 0.4;
    }
    @media (max-width: 600px) {
      body {
        margin: 10px;
        font-size: 14px;
      }
      input, button {
        padding: 8px;
        font-size: 14px;
      }
      .songItem {
        font-size: 14px;
      }
      #message {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>

  <h1>曲を登録する</h1>

  <div id="registerArea">
    <input type="text" id="titleInput" placeholder="タイトル">
    <input type="text" id="artistInput" placeholder="原曲者さん">
    <input type="text" id="keyInput" placeholder="キー">
    <button id="addButton" onclick="addSong()">登録する</button>
    <div id="message">登録完了!</div>
  </div>

  <hr>

  <h2>曲を探す</h2>

  <div id="searchArea">
    <input type="text" id="searchInput" placeholder="探したい曲はー？" oninput="searchSongs()">
    <div id="searchResultCount"></div>
  </div>

  <div id="songList"></div>

  <script>
    let songs = [];
    let editIndex = null;

    const songsRef = database.ref('songs');

    function addSong() {
      const title = document.getElementById('titleInput').value.trim();
      const artist = document.getElementById('artistInput').value.trim();
      const key = document.getElementById('keyInput').value.trim();

      if (title && key) {
        const songData = {
          title,
          artist: artist || '가수 없음',
          key
        };
        songsRef.push(songData);
        clearInputs();
        showMessage("登録完了!");
      } else {
        alert('Titleとキーを入力してください');
      }
    }

    function clearInputs() {
      document.getElementById('titleInput').value = '';
      document.getElementById('artistInput').value = '';
      document.getElementById('keyInput').value = '';
    }

    function showMessage(text) {
      const message = document.getElementById('message');
      message.textContent = text;
      message.style.visibility = 'visible';
      setTimeout(() => {
        message.style.visibility = 'hidden';
      }, 1500);
    }

    function showSongs(list) {
      const songListDiv = document.getElementById('songList');
      songListDiv.innerHTML = '';

      if (list.length === 0) {
        songListDiv.textContent = '登録されていない曲です';
        document.getElementById('searchResultCount').textContent = '';
        return;
      }

      document.getElementById('searchResultCount').textContent = `${list.length}件見つかりました`;

      const sortedList = [...list].sort((a, b) => a.title.localeCompare(b.title, 'ja'));

      sortedList.forEach(song => {
        const div = document.createElement('div');
        div.className = 'songItem';
        div.innerHTML = `◦ ${song.title} / ${song.artist} / ${song.key}`;
        songListDiv.appendChild(div);
      });
    }

    function searchSongs() {
      const keyword = document.getElementById('searchInput').value.trim().toLowerCase();
      const filtered = songs.filter(song =>
        song.title.toLowerCase().includes(keyword) ||
        song.artist.toLowerCase().includes(keyword) ||
        song.key.toLowerCase().includes(keyword)
      );
      showSongs(filtered);
    }

    songsRef.on('value', (snapshot) => {
      const data = snapshot.val();
      if (data) {
        songs = Object.values(data);
      } else {
        songs = [];
      }
      showSongs(songs);
    });

    document.addEventListener('keydown', function(event) {
      if (event.key === 'Enter') {
        addSong();
      }
    });
  </script>

</body>
</html>
